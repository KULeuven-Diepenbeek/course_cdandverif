<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.68.3" />
    <meta name="description" content="">


    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>305 Mailboxes :: Chip Design and Verification</title>

    
    <link href="../../css/nucleus.css?1692348126" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1692348126" rel="stylesheet">
    <link href="../../css/hybrid.css?1692348126" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1692348126" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1692348126" rel="stylesheet">
    <link href="../../css/auto-complete.css?1692348126" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1692348126" rel="stylesheet">
    <link href="../../css/theme.css?1692348126" rel="stylesheet">
    <link href="../../css/tabs.css?1692348126" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1692348126" rel="stylesheet">
    
    <link href="../../css/theme-kul.css?1692348126" rel="stylesheet">
    
    

    <script src="../../js/jquery-3.3.1.min.js?1692348126"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
<script src=../../js/exercises.js></script> 
  </head>
  <body class="" data-url="/300_oo/305_mailboxes/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://www.kuleuven.be/kuleuven/" target="_blank">
  <img src="../../img/style/kul.png" alt="KU Leuven" /><br/>
</a>
<a href="https://www.uhasselt.be/" target="_blank">
  <img src="../../img/style/uhasselt.svg" alt="UHasselt" id="uhlogo" />
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1692348126"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1692348126"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/kuleuven-diepenbeek.github.io\/course_cdandverif\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1692348126"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/000_intro/" title="0 Introduction" class="dd-item
        
        
        
        ">
      <a href="../../000_intro/">
          0 Introduction
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/000_intro/000_introduction/" title="000 Introduction" class="dd-item ">
        <a href="../../000_intro/000_introduction/">
        000 Introduction
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/000_intro/001_organisation/" title="001 Organisation" class="dd-item ">
        <a href="../../000_intro/001_organisation/">
        001 Organisation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/000_intro/002_lab/" title="002 Lab" class="dd-item ">
        <a href="../../000_intro/002_lab/">
        002 Lab
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/100_wetfeet/" title="1 Getting your feet wet" class="dd-item
        
        
        
        ">
      <a href="../../100_wetfeet/">
          1 Getting your feet wet
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/100_wetfeet/100_alu/" title="100 ALU" class="dd-item ">
        <a href="../../100_wetfeet/100_alu/">
        100 ALU
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/100_wetfeet/101_testing/" title="101 Testing" class="dd-item ">
        <a href="../../100_wetfeet/101_testing/">
        101 Testing
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/100_wetfeet/102_systemverilog/" title="102 SystemVerilog" class="dd-item ">
        <a href="../../100_wetfeet/102_systemverilog/">
        102 SystemVerilog
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/100_wetfeet/103_interfaces/" title="103 Interfaces" class="dd-item ">
        <a href="../../100_wetfeet/103_interfaces/">
        103 Interfaces
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/100_wetfeet/104_helloworld/" title="104 Hello world" class="dd-item ">
        <a href="../../100_wetfeet/104_helloworld/">
        104 Hello world
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/100_wetfeet/105_assignment/" title="105 Assignment 1" class="dd-item ">
        <a href="../../100_wetfeet/105_assignment/">
        105 Assignment 1
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/200_increase/" title="2 Adding some registers" class="dd-item
        
        
        
        ">
      <a href="../../200_increase/">
          2 Adding some registers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/200_increase/201_registerfile/" title="201 Register file" class="dd-item ">
        <a href="../../200_increase/201_registerfile/">
        201 Register file
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_increase/202_test/" title="202 Updating test" class="dd-item ">
        <a href="../../200_increase/202_test/">
        202 Updating test
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_increase/203_practice/" title="203 Practice" class="dd-item ">
        <a href="../../200_increase/203_practice/">
        203 Practice
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/300_oo/" title="3 Climbing the OO ladder" class="dd-item
        parent
        
        
        ">
      <a href="../../300_oo/">
          3 Climbing the OO ladder
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/300_oo/301_layered_testbench/" title="301 Layered testbench" class="dd-item ">
        <a href="../../300_oo/301_layered_testbench/">
        301 Layered testbench
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/300_oo/302_monitor/" title="302 Adding a monitor" class="dd-item ">
        <a href="../../300_oo/302_monitor/">
        302 Adding a monitor
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/300_oo/303_joinorfail/" title="303 Join or fail" class="dd-item ">
        <a href="../../300_oo/303_joinorfail/">
        303 Join or fail
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/300_oo/304_transactions/" title="304 Transactions" class="dd-item ">
        <a href="../../300_oo/304_transactions/">
        304 Transactions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/300_oo/305_mailboxes/" title="305 Mailboxes" class="dd-item active">
        <a href="../../300_oo/305_mailboxes/">
        305 Mailboxes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/300_oo/306_assignment/" title="306 Assignment 2" class="dd-item ">
        <a href="../../300_oo/306_assignment/">
        306 Assignment 2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/300_oo/307_scoreboard/" title="307 Checker &amp; scoreboard" class="dd-item ">
        <a href="../../300_oo/307_scoreboard/">
        307 Checker &amp; scoreboard
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/300_oo/308_golden/" title="308 Golden reference" class="dd-item ">
        <a href="../../300_oo/308_golden/">
        308 Golden reference
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/400_rand/" title="4 Randomisation" class="dd-item
        
        
        
        ">
      <a href="../../400_rand/">
          4 Randomisation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/400_rand/401_randomisation/" title="401 Randomisation" class="dd-item ">
        <a href="../../400_rand/401_randomisation/">
        401 Randomisation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/400_rand/402_constraint/" title="402 Constraints" class="dd-item ">
        <a href="../../400_rand/402_constraint/">
        402 Constraints
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/400_rand/403_dpandcp/" title="403 DP and CP" class="dd-item ">
        <a href="../../400_rand/403_dpandcp/">
        403 DP and CP
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/400_rand/404_assignment/" title="404 Assignment 3" class="dd-item ">
        <a href="../../400_rand/404_assignment/">
        404 Assignment 3
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/500_coverage/" title="5 Coverage" class="dd-item
        
        
        
        ">
      <a href="../../500_coverage/">
          5 Coverage
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/500_coverage/501_coverage/" title="501 Coverage" class="dd-item ">
        <a href="../../500_coverage/501_coverage/">
        501 Coverage
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/500_coverage/502_funccoverage/" title="502 Functional coverage" class="dd-item ">
        <a href="../../500_coverage/502_funccoverage/">
        502 Functional coverage
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/500_coverage/503_crosscoverage/" title="503 Cross coverage" class="dd-item ">
        <a href="../../500_coverage/503_crosscoverage/">
        503 Cross coverage
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/500_coverage/504_morebins/" title="504 More on bins" class="dd-item ">
        <a href="../../500_coverage/504_morebins/">
        504 More on bins
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/500_coverage/505_assignment/" title="505 Assignment 4" class="dd-item ">
        <a href="../../500_coverage/505_assignment/">
        505 Assignment 4
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/600_assertions/" title="6 Assertions" class="dd-item
        
        
        
        ">
      <a href="../../600_assertions/">
          6 Assertions
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/600_assertions/601_assertions/" title="601 Assertions" class="dd-item ">
        <a href="../../600_assertions/601_assertions/">
        601 Assertions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/600_assertions/602_sequences/" title="602 Sequences" class="dd-item ">
        <a href="../../600_assertions/602_sequences/">
        602 Sequences
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/600_assertions/603_implications/" title="603 Implications" class="dd-item ">
        <a href="../../600_assertions/603_implications/">
        603 Implications
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/700_project/" title="7 Project" class="dd-item
        
        
        
        ">
      <a href="../../700_project/">
          7 Project
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/800_finalremarks/" title="8 Final remarks" class="dd-item
        
        
        
        ">
      <a href="../../800_finalremarks/">
          8 Final remarks
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/800_finalremarks/801_final/" title="801 Final remarks" class="dd-item ">
        <a href="../../800_finalremarks/801_final/">
        801 Final remarks
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/appendices/" title="Appendices" class="dd-item
        
        
        
        ">
      <a href="../../appendices/">
          Appendices
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/appendices/cheat/" title="QuestaSim Commanline Cheats" class="dd-item ">
        <a href="../../appendices/cheat/">
        QuestaSim Commanline Cheats
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://studiegidswww.uhasselt.be/opleidingsonderdeel.aspx?a=2023&amp;i=3467&amp;n=4&amp;t=04#anker46108"><i class='fa fa-university'></i> ECTS Sheet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://toledo.kuleuven.be/"><i class='fa fa-university'></i> Toledo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Chip Design and Verification</a> > <a href='../../300_oo/'>3 Climbing the OO ladder</a> > 305 Mailboxes
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        




<h1 id="mailboxes">Mailboxes</h1>

<p>Up until this point the <em>layered testbench</em> was presented: there are different layers each with their own purpose. Also: transactions were shortly discussed. Next up &hellip; handing out transactions between different layers.</p>

<div class="multiHcolumn">
  
<div class="column">
  <p><strong>Mailbox</strong> is a built-in class. It works similar to an actual (single direction) mailbox. It&rsquo;s worth pointing out that a mailbox operates like a FIFO (whereas an actual mailbox might operate as a LIFO (?)) and it has the following methods:</p>

<ul>
<li><strong>new( )</strong>: create a new mailbox</li>
<li><strong>put( )</strong>: put a message in the mailbox</li>
<li><strong>get( )</strong>: get a message from the mailbox</li>
<li><strong>peek( )</strong>: copy a message from the mailbox</li>
<li><strong>num( )</strong>: retrieve the number of messages in the mailbox</li>
</ul>

</div>    
<div class="column">
  <p>Except for the new( ) and num( ) function, all of these methods are blocking functions. This means, upon running the <strong>get()</strong> function, the software keeps on <em>getting</em> a message, until it succeeds.</p>

<p>As this might not always be desirable, there also exist these non-blocking alternatives:</p>

<ul>
<li><strong>try_put( )</strong>: put a message in the mailbox</li>
<li><strong>try_get( )</strong>: get a message from the mailbox</li>
<li><strong>try_peek( )</strong>: copy a message from the mailbox</li>
</ul>

</div>    

<p></div></p>


<div class="notices info" ><p>Try to think of a reason why <strong>put</strong>, <strong>get</strong> and <strong>peek</strong> would block !</p>
</div>


<p><strong>Mailboxes</strong> accept any type of variable or object, by default. You can (and should) make them type specific with <em>parametrisation</em>.</p>

<div class="multiHcolumn">
  
<div class="column">
  <p>This creates a mailbox with room for 10 entries of any type.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-systemverilog" data-lang="systemverilog">  mailbox bigRedShinyBox <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>(<span style="color:#ae81ff">10</span>);
</code></pre></div></p>

</div>    
<div class="column">
  <p>This creates a mailbox with room for 10 variables of <em>int</em> type.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-systemverilog" data-lang="systemverilog">  mailbox #(<span style="color:#66d9ef">int</span>) bigBlueShinyBox <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>(<span style="color:#ae81ff">10</span>);
</code></pre></div></p>

</div>    

<p></div></p>

<p>For the sake of completeness it is mentioned that SystemVerilog has another built-in class that allows inter-process communication: <strong>Semaphores</strong>. This will not be handled in these labs, but more information on semaphores can be found <a href="https://verificationguide.com/systemverilog/systemverilog-semaphore/" target="_blank">here</a> or on <a href="http://www.google.com" target="_blank"><span style="font-weight: bold"><span style="color: #4885ed">G</span><span style="color: #db3236">o</span><span style="color: #f4c20d">o</span><span style="color: #4885ed">g</span><span style="color: #3cba54">l</span><span style="color: #db3236">e</span></span></a>
.</p>

<h2 id="let-s-see-it-in-action">Let&rsquo;s see it in action</h2>

<p>As with many things, hands-on experience helps understanding certain principles. Let&rsquo;s see the mailbox in action. The testbench was left with a generator generating 10 transactions. Here, we&rsquo;re adding a mailbox, so the generator can <em>mail</em> the transactions to the <em>driver</em>.</p>

<div class="multiHcolumn">
  
<div class="column">
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-systemverilog" data-lang="systemverilog"><span style="color:#66d9ef">`include</span> <span style="color:#e6db74">&#34;transaction.sv&#34;</span>

<span style="color:#66d9ef">class</span> generator;

  mailbox #(transaction) gen2drv;

  <span style="color:#66d9ef">function</span> <span style="color:#66d9ef">new</span>(mailbox #(transaction) g2d);
    <span style="color:#66d9ef">this</span>.gen2drv <span style="color:#f92672">=</span> g2d;
  <span style="color:#66d9ef">endfunction</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span>

  <span style="color:#66d9ef">task</span> run;
    <span style="color:#66d9ef">string</span> s;
    transaction tra;

    $timeformat(<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#34; ns&#34;</span> , <span style="color:#ae81ff">10</span>);

    s <span style="color:#f92672">=</span> $sformatf(<span style="color:#e6db74">&#34;[%t | GEN] I will start generating for the mailbox&#34;</span>, $time);
    $display(s);

    <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">10</span>; i<span style="color:#f92672">++</span>)
    <span style="color:#66d9ef">begin</span>
      tra <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>();
      s <span style="color:#f92672">=</span> $sformatf(<span style="color:#e6db74">&#34;[%t | GEN] new instruction %s&#34;</span>, $time, tra.toString());
      $display(s);
      <span style="color:#66d9ef">this</span>.gen2drv.put(tra);
    <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">endtask</span> <span style="color:#f92672">:</span> run

<span style="color:#66d9ef">endclass</span> <span style="color:#f92672">:</span> generator
</code></pre></div>

<p></div><br />
<div class="column">
  <p>This example shows how the <strong>generator</strong> uses a mailbox.</p></p>

<p>First, there is a class property <strong>gen2drv</strong>. Upon making an instantiation of the class <em>generator</em>, the constructor assigns the property to a mailbox-object. Note that this mailbox only accepts object&rsquo;s of the type <em>transaction</em>.</p>

<p>Whenever the run function is executed and the generator is working its magic, the resulting transaction is <strong>put</strong> into the objects mailbox.</p>

<p>And &hellip; that&rsquo;s it ðŸ˜ƒ</p>

<p></div></p>

<p></div></p>


<div class="notices info" ><p>Try to think of a reason why the variable <strong>tra</strong> can be reused? Wouldn&rsquo;t the next iteration of the for-loop overwrite the values of the previously generated transaction?</p>
</div>


<div class="multiHcolumn">
  
<div class="column">
  <p>This example shows how the <strong>driver</strong> uses the mailbox.</p>

<p>Similarly to the generator, first, there is a class property <strong>gen2drv</strong>. Upon making an instantiation, the constructor assigns the property to a mailbox-object.</p>

<div class="notices info" ><p>Note that the name is independent, but the same. The philosophy behind is: first give the name of the <em>sender</em>, followed by a &ldquo;2&rdquo;, appended with the name of the <em>destination</em>.</p>
</div>

<p>In the run_addition( ) function, the driver will wait for a transaction. Once this has arrived, it waits for a falling edge of the clock. Finally it drives the new inputs as they appear in the transaction.</p>

<p>And &hellip; that&rsquo;s it ðŸ˜ƒ</p>

<p></div></p>

<div class="column">
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-systemverilog" data-lang="systemverilog"><span style="color:#66d9ef">class</span> driver;

  <span style="color:#66d9ef">virtual</span> gbprocessor_iface ifc;
  mailbox #(transaction) gen2drv;

  <span style="color:#66d9ef">function</span> <span style="color:#66d9ef">new</span>(<span style="color:#66d9ef">virtual</span> gbprocessor_iface ifc, mailbox #(transaction) g2d);
    <span style="color:#66d9ef">this</span>.ifc <span style="color:#f92672">=</span> ifc;
    <span style="color:#66d9ef">this</span>.gen2drv <span style="color:#f92672">=</span> g2d;
  <span style="color:#66d9ef">endfunction</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span>

  <span style="color:#66d9ef">task</span> run_addition();
    <span style="color:#66d9ef">string</span> s;
    transaction tra;
    
    $timeformat(<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#34; ns&#34;</span> , <span style="color:#ae81ff">10</span>);

    s <span style="color:#f92672">=</span> $sformatf(<span style="color:#e6db74">&#34;[%t | DRV] I will start driving from the mailbox&#34;</span>, $time);
    $display(s);
    
    <span style="color:#66d9ef">forever</span> 
    <span style="color:#66d9ef">begin</span>

        <span style="color:#66d9ef">this</span>.ifc.valid <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b0</span>;
        <span style="color:#66d9ef">this</span>.gen2drv.get(tra);

        @(<span style="color:#66d9ef">posedge</span> <span style="color:#66d9ef">this</span>.ifc.clock);

        <span style="color:#66d9ef">this</span>.ifc.valid <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span><span style="color:#ae81ff">&#39;b1</span>;
        <span style="color:#66d9ef">this</span>.ifc.instruction <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">8&#39;h82</span>;

    <span style="color:#66d9ef">end</span> <span style="color:#75715e">/* forever */</span>


    s <span style="color:#f92672">=</span> $sformatf(<span style="color:#e6db74">&#34;[%t | DRV] done&#34;</span>, $time);
    $display(s);
         
  <span style="color:#66d9ef">endtask</span> <span style="color:#f92672">:</span> run_addition

<span style="color:#66d9ef">endclass</span> <span style="color:#f92672">:</span> driver
</code></pre></div>

<p></div></p>

<p></div></p>

<p>Where only a couple of pages back, the driver was concerning itself with the actual values, it no longer has that responsibility. It simply executes what it is instructed to, by mail.</p>

<p>Now we have generation and handling of mail, but &hellip; how did the mailbox come into existence ? Right &hellip; that should be done one abstraction level higher: <strong>in the environment</strong>.</p>

<div class="multiHcolumn">
  
<div class="column">
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-systemverilog" data-lang="systemverilog"><span style="color:#66d9ef">`include</span> <span style="color:#e6db74">&#34;transaction.sv&#34;</span>
<span style="color:#66d9ef">`include</span> <span style="color:#e6db74">&#34;generator.sv&#34;</span>
<span style="color:#66d9ef">`include</span> <span style="color:#e6db74">&#34;driver.sv&#34;</span>
<span style="color:#66d9ef">`include</span> <span style="color:#e6db74">&#34;monitor.sv&#34;</span>

<span style="color:#66d9ef">class</span> environment;

  mailbox #(transaction) gen2drv;

  <span style="color:#66d9ef">virtual</span> gbprocessor_iface ifc;

  generator gen;
  driver drv;
  monitor mon;

  <span style="color:#66d9ef">function</span> <span style="color:#66d9ef">new</span>(<span style="color:#66d9ef">virtual</span> gbprocessor_iface ifc);
    <span style="color:#66d9ef">this</span>.ifc <span style="color:#f92672">=</span> ifc;

    <span style="color:#66d9ef">this</span>.gen2drv <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>(<span style="color:#ae81ff">5</span>);

    <span style="color:#66d9ef">this</span>.gen <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>(<span style="color:#66d9ef">this</span>.gen2drv);
    <span style="color:#66d9ef">this</span>.drv <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>(ifc, <span style="color:#66d9ef">this</span>.gen2drv);
    <span style="color:#66d9ef">this</span>.mon <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>(ifc);
  <span style="color:#66d9ef">endfunction</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span>

  <span style="color:#66d9ef">task</span> run();
    <span style="color:#66d9ef">string</span> s;

    $timeformat(<span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#34; ns&#34;</span> , <span style="color:#ae81ff">10</span>);

    s <span style="color:#f92672">=</span> $sformatf(<span style="color:#e6db74">&#34;[%t | ENV] I will set up the components&#34;</span>, $time);
    $display(s);

    <span style="color:#66d9ef">this</span>.drv.do_reset();

    <span style="color:#66d9ef">fork</span>
      <span style="color:#66d9ef">this</span>.drv.run_addition();
      <span style="color:#66d9ef">this</span>.mon.run();
      <span style="color:#66d9ef">this</span>.gen.run();
    <span style="color:#66d9ef">join_any</span>;

    s <span style="color:#f92672">=</span> $sformatf(<span style="color:#e6db74">&#34;[%t | ENV]  end of run()&#34;</span>, $time);
    $display(s);

  <span style="color:#66d9ef">endtask</span> <span style="color:#f92672">:</span> run

<span style="color:#66d9ef">endclass</span> <span style="color:#f92672">:</span> environment
</code></pre></div>

<p></div><br />
<div class="column">
  <p>As you can already see from the number of lines, some elaboration would be welcome.</p></p>

<p>First, the environment class has a class property: <strong>gen2drv</strong>. Its type is a parametrised mailbox.</p>

<p>Next to the <strong>driver</strong> and <strong>monitor</strong> properties, there is also a <strong>generator</strong> property.</p>

<p>Upon creation of an environment, the mailbox-class is instantiated. The parameter <strong>5</strong> that is given determines the size (depth) of the mailbox.</p>

<hr/>

<p>Apart from creating the mailbox and attaching both ends to the correct components, the <strong>generator</strong> also has to be triggered. As the driver now also has a <em>forever-loop</em>, it can be started together with the monitor, in parallel.</p>

<p>After running for 10 clock cycles the <strong>run( )</strong> function of the generator is triggered.</p>

<p>When the generator has finished, everything in the outer fork-join will be disabled and the test is done.</p>

<p></div></p>

<p></div></p>

<p><img src="../../img/screenshot_305.png" alt="Result of the code above" /></p>

<p>Quick questions:</p>

<ul>
<li>how many testvectors were generated ?</li>
<li>are all testvectors generated at the same moment ? Explain why !!</li>
<li>which component/object is the one that determines how long the test takes ?</li>
</ul>


<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../../300_oo/304_transactions/" title="304 Transactions"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../300_oo/306_assignment/" title="306 Assignment 2" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1692348126"></script>
    <script src="../../js/perfect-scrollbar.min.js?1692348126"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1692348126"></script>
    <script src="../../js/jquery.sticky.js?1692348126"></script>
    <script src="../../js/featherlight.min.js?1692348126"></script>
    <script src="../../js/highlight.pack.js?1692348126"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1692348126"></script>
    <script src="../../js/learn.js?1692348126"></script>
    <script src="../../js/hugo-learn.js?1692348126"></script>
    
        
            <script src="../../mermaid/mermaid.js?1692348126"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

